{% extends "layout.html" %}
{% block title %}Usuarios{% endblock %}
{% block head %}
{{ super() }}


{% endblock %}
{% block content %}

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <h3>Estudio #{{estudio.id}}</h3>
    </div>
    <div class="row">
        <div class="col-10">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Esperando consentimiento informado</h3>
                </div>
                <div class="card-body">
                    {% if estudio.estadoActual <= 2 %} <form class="row g-3 align-items-end"
                        action="{{ url_for('estudio_estado2_carga' , estudio=estudio.id) }}" method="POST">

                        <div class="col-md-8">

                            <a href="javascript:demoFromHTML()" class="btn btn-outline-secondary btn-sm" {#
                                href="{{ url_for('download', filename=ruta_archivo) }}" #}>Descargar
                                consentimiento para enviar </a>
                        </div>

                        <div class="col-md-8 mt-5">
                            <div class="custom-file">
                                <input type="file" class="custom-file-input" name="consentimiento" id="customFile"
                                    data-buttonText="Your label here.">
                                <label class="custom-file-label" for="customFile">Cargar consentimiento informado
                                    firmado enviado por
                                    el
                                    paciente...</label>
                            </div>
                        </div>
                        <div id="print" class="d-none">

                            <h3 id="logo" class="me-4" style="font-family: 'Source Sans Pro';">LABttps</h3>
                            <p>La Plata, Calle 123</p>
                            <p>Contacto: info@laboratoriotpps.com</p>
                            <hr>
                            </br>
                            <p><strong> {{tipoEstudio.nombre}} </strong></p>
                            <p> {{tipoEstudio.consentimientoInformado}} </p>
                            </br>
                            </br>
                            </br>
                            </br>
                            </br>
                            <p>...........................</p>
                            <p>Firma y aclaraci√≥n</p>
                            <hr>
                        </div>
                        <div id="elementH"></div>




                        <div class="col-12">
                            <button id="btn-enviar" type="submit" class="btn btn-primary mt-5"
                                disabled>Siguiente</button>
                        </div>
                        </form>
                        {% else %}
                        <div class="col-md-8">

                            <a href="javascript:demoFromHTML()" class="btn btn-outline-secondary btn-sm">Descargar
                                archivo
                                consentimiento firmado </a>
                        </div>


                        {% endif %}

                </div>
            </div>
        </div>
    </div>
    {% include 'includes/workflow.html' %}

    <a href="{{ url_for('empleado_home') }}" class="btn btn-outline-secondary mt-5">Volver a home</a>
</div>








{% endblock %}
{% block scripts %}
{#
<!-- jQuery -->
<script src="/static/assets/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="/static/assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="/static/assets/dist/js/adminlte.min.js"></script>
#}
<!-- bs-custom-file-input -->



<!---ullllltimo-->
<script src="/static/assets/plugins/bs-custom-file-input/bs-custom-file-input.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
<script type="text/javascript">


    var files = document.getElementById('customFile');
    var submit = document.getElementById('btn-enviar');
    files.addEventListener("change", function () {
        if (files.files.length) {
            submit.disabled = false;
            return;
        }
        submit.disabled = true;
    });



</script>
<script>
    $(function () {
        bsCustomFileInput.init();
    });
</script>





<script>
    function demoFromHTML() {
        var doc = new jsPDF();
        var elementHTML = $('#print').html();
        var specialElementHandlers = {
            '#elementH': function (element, renderer) {
                return true;
            }
        };
        doc.fromHTML(elementHTML, 15, 15, {
            'width': 700,
            'elementHandlers': specialElementHandlers
        });

        // Save the PDF
        doc.save('consentimiento.pdf');

    }


</script>

{% endblock %}{#
function demoFromHTML() {

fetch("{{ url_for('template.html' , titulo='asdasd') }}")
.then(res => res.text())
.then(content => {
let lines = content.split(/\n/);
let source = ''
lines.forEach(line => source = source + line);
console.log(source)
var pdf = new jsPDF('p', 'pt', 'letter');

specialElementHandlers = {
'#bypassme': function (element, renderer) {
return true
}
};
margins = {
top: 80,
bottom: 60,
left: 40,
width: 522
};
pdf.fromHTML(
source, // HTML string or DOM elem ref.
margins.left, // x coord
margins.top, { // y coord
'width': margins.width, // max width of content on PDF
'elementHandlers': specialElementHandlers
},

function (dispose) {
pdf.save('Test.pdf');
}, margins
);
});
}*/
#}